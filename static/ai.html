<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Tahlil - NGMS</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script>if(localStorage.getItem('ngms_sb')==='c')document.documentElement.classList.add('collapsed')</script>
</head>
<body>

<main class="main-content">
    <div class="page-header"><div><h1 class="page-title">AI Tahlil</h1><p class="page-subtitle">Sun'iy intellekt bilan biznes tahlili</p></div></div>

    <div class="card mb-4">
        <div class="card-header"><h3 class="card-title">AI ga savol bering</h3></div>
        <div class="card-body">
            <form id="questionForm">
                <div class="form-group"><label class="form-label">Savolingiz</label><textarea id="questionInput" class="form-input" rows="3" placeholder="Masalan: Qaysi mahsulotlar eng ko'p foyda keltirmoqda?"></textarea></div>
                <button type="submit" class="btn btn-primary" id="askBtn">So'rash</button>
            </form>
            <div id="answerBox" class="mt-4" style="display:none">
                <div style="background:var(--accent-dim);padding:16px;border-radius:var(--radius);border-left:3px solid var(--accent)">
                    <p id="aiAnswer" style="white-space:pre-line;line-height:1.7;font-size:13px;color:var(--text-secondary)"></p>
                </div>
            </div>
        </div>
    </div>

    <div class="grid grid-2 mb-4">
        <div class="card"><div class="card-header"><h3 class="card-title">Tavsiyalar</h3></div><div class="card-body" id="recsBox"><div class="spinner" style="margin:0 auto"></div></div></div>
        <div class="card"><div class="card-header"><h3 class="card-title">Xavflar</h3></div><div class="card-body" id="risksBox"><div class="spinner" style="margin:0 auto"></div></div></div>
    </div>

    <div class="card">
        <div class="card-header"><h3 class="card-title">Biznes hisoboti</h3><button class="btn btn-sm btn-ghost" onclick="genReport()">Yangilash</button></div>
        <div class="card-body" id="reportBox"><div class="spinner" style="margin:0 auto"></div></div>
    </div>
</main>

<script src="/static/js/cache.js"></script>
<script src="/static/js/api.js"></script>
<script src="/static/js/nav.js"></script>
<script>
document.getElementById('questionForm').addEventListener('submit',async function(e){
    e.preventDefault();var q=document.getElementById('questionInput').value.trim();if(!q)return;
    var b=document.getElementById('askBtn');b.textContent='Kutilmoqda...';b.disabled=true;
    try{var r=await aiAPI.askQuestion(q);document.getElementById('aiAnswer').textContent=r.answer;document.getElementById('answerBox').style.display='block'}
    catch(e){document.getElementById('aiAnswer').textContent='Xatolik: '+e.message;document.getElementById('answerBox').style.display='block'}
    finally{b.textContent="So'rash";b.disabled=false}
});
async function loadRecs(){try{var r=await aiAPI.getRecommendations();document.getElementById('recsBox').innerHTML='<p style="white-space:pre-line;line-height:1.7;font-size:13px;color:var(--text-secondary)">'+r.recommendations+'</p>'}catch(e){document.getElementById('recsBox').innerHTML='<p class="text-gray" style="font-size:13px">Mavjud emas</p>'}}
async function loadRisks(){try{var r=await aiAPI.getRisks();document.getElementById('risksBox').innerHTML='<p style="white-space:pre-line;line-height:1.7;font-size:13px;color:var(--text-secondary)">'+r.risks+'</p>'}catch(e){document.getElementById('risksBox').innerHTML='<p class="text-gray" style="font-size:13px">Mavjud emas</p>'}}
async function genReport(){document.getElementById('reportBox').innerHTML='<div class="spinner" style="margin:0 auto"></div>';try{var r=await aiAPI.generateReport();document.getElementById('reportBox').innerHTML='<p style="white-space:pre-line;line-height:1.7;font-size:13px;color:var(--text-secondary)">'+r.report+'</p>'}catch(e){document.getElementById('reportBox').innerHTML='<p class="text-gray" style="font-size:13px">Xatolik</p>'}}
loadRecs();loadRisks();genReport();
</script>
</body>
</html>
